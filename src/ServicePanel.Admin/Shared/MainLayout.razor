@inherits LayoutComponentBase
@implements IDisposable
@inject LayoutService LayoutService

<PageTitle>Windows服务控制面板</PageTitle>

<MudRTLProvider RightToLeft="@_rightToLeft">
    <audio id="notification" src="/media/notification.mp3" />
    <MudThemeProvider Theme="@LayoutService.CurrentTheme" IsDarkMode="@LayoutService.IsDarkMode" IsDarkModeChanged="LayoutService.SetDarkMode" />
    <MudDialogProvider />
    <MudSnackbarProvider />

    <MudLayout>
        <MainBody>
            @Body
        </MainBody>
    </MudLayout>
</MudRTLProvider>

@code {

    private bool _rightToLeft = false;

    protected override void OnInitialized()
    {
        LayoutService.MajorUpdateOccured += LayoutServiceOnMajorUpdateOccured;
        LayoutService.SetBaseTheme(ServicePanelTheme.DefaultTheme());
        base.OnInitialized();
    }

    private async Task RightToLeftToggle(bool value)
    {
        _rightToLeft = value;
        await Task.CompletedTask;
    }

    public void Dispose()
    {
        LayoutService.MajorUpdateOccured -= LayoutServiceOnMajorUpdateOccured;
    }

    private void LayoutServiceOnMajorUpdateOccured(object sender, EventArgs e) => StateHasChanged();
}
